<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="style.css" />
    <script defer src="https://cdn.mainnet.cash/mainnet-1.0.6.js"></script>
  </head>
  <body>
    <script>document.addEventListener("DOMContentLoaded", async (event) => {
        Object.assign(globalThis, await __mainnetPromise);

        DefaultProvider.servers.testnet = ["wss://chipnet.imaginary.cash:50004"]
        const wallet = await TestNetWallet.named("mywallet");

        const balance = await wallet.getBalance();
        const balanceTokens = await wallet.getAllTokenBalances();
        document.querySelector('#balance').innerText = `${balance.sat} testnet satoshis`;
        //document.querySelector('#tokenBalance').innerText = `$${balance.usd}`;

        wallet.watchBalance((balance) => {
            document.querySelector('#balance').innerText = `${balance.sat} testnet satoshis`;
            //document.querySelector('#tokenBalance').innerText = `${balance.sat} testnet satoshi`;
        });
        const addr = await wallet.getDepositAddress();
        const tokenAddr = await wallet.getTokenDepositAddress ();
        document.querySelector('#depositAddr').innerText = addr;

        const qr = await wallet.getTokenDepositQr();
        document.querySelector('#depositQr').src = qr.src;

        document.querySelector('#send').addEventListener("click", async () => {
        const addr = document.querySelector('#sendAddr').value;
        const {txId} = await wallet.send([{cashaddr: addr, value: 1000, unit: "sat"}]);
        alert('Sent 1000 sats to ' + addr);
        console.log('Sent 1000 sats to ' + addr + `\nhttps://chipnet.imaginary.cash/tx/${txId}`);
        });

        document.querySelector('#sendMax').addEventListener("click", async () => {
        const addr = document.querySelector('#sendAddr').value;
        const {txId} = await wallet.sendMax(addr);
        alert('Sent all funds to ' + addr);
        console.log('Sent all funds to ' + addr + `\nhttps://chipnet.imaginary.cash/tx/${txId}`);
        });

    })</script>
    <main style="display: flex; flex-direction: row;">
        <div class="wallet">
            <h1>My CashTokens Webwallet</h1>
            <div>Wallet balance: <span id="balance"></span></div>
            <div>Wallet token balance: <span id="tokenBalance"></span></div>
            <div>CashTokens enabled address: <span id="depositAddr"></span></div>
            <div>Deposit QR: <img id="depositQr" class="depositQr"/></div>
            <div>
            <br>
            Send to address
            <input id="sendAddr"></input>
            <input type="button" id="send" value="Send 1000 sats"></input>
            <input type="button" id="sendMax" value="Send All Funds"></input>
            </div>
        </div>
    </main>
  </body>
  <footer>
        <a href="https://github.com/mr-zwets/mvp-cashtokens-webwallet" target="_blanc">
            <img class="githublogo" src="./github.png">
        </a>
        <p>
            built with <a href="https://mainnet.cash/" target="_blanc">Mainnet.cash</a>
        </p>
    </footer>
</html>